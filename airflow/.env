# ================================
# AIRFLOW CORE CONFIGURATION
# ================================

# User and Permissions
AIRFLOW_UID=50000

# Core Settings
AIRFLOW__CORE__EXECUTOR=LocalExecutor
AIRFLOW__CORE__LOAD_EXAMPLES=false
AIRFLOW__CORE__FERNET_KEY=7u3tlIoRxDDPPuT3IV3p2C--r_ILqNcTy1zooejWgRU=
AIRFLOW__CORE__DAGS_ARE_PAUSED_AT_CREATION=true
AIRFLOW__CORE__TEST_CONNECTION=Enabled
AIRFLOW__CORE__DEFAULT_TIMEZONE=Asia/Jakarta

# ================================
# DATABASE CONFIGURATION
# ================================

# Airflow Metadata Database (PostgreSQL)
AIRFLOW__DATABASE__SQL_ALCHEMY_CONN=postgresql+psycopg2://airflow:airflow@airflow-postgres:5432/airflow
POSTGRES_USER=airflow
POSTGRES_PASSWORD=airflow
POSTGRES_DB=airflow

# Database Initialization
_AIRFLOW_DB_UPGRADE=true

# ================================
# WEBSERVER CONFIGURATION
# ================================

# Admin User Setup
_AIRFLOW_WWW_USER_CREATE=True
_AIRFLOW_WWW_USER_USERNAME=airflow
_AIRFLOW_WWW_USER_PASSWORD=airflow
_AIRFLOW_WWW_USER_FIRSTNAME=Admin
_AIRFLOW_WWW_USER_LASTNAME=User
_AIRFLOW_WWW_USER_EMAIL=admin@example.com

# Webserver Performance
AIRFLOW__WEBSERVER__WORKERS=1
AIRFLOW__WEBSERVER__DEFAULT_UI_TIMEZONE=Asia/Jakarta
AIRFLOW__WEBSERVER__WORKER_CLASS=sync
AIRFLOW__WEBSERVER__WORKER_TIMEOUT=300
AIRFLOW__WEBSERVER__WEB_SERVER_WORKER_TIMEOUT=300
AIRFLOW__WEBSERVER__WORKER_REFRESH_BATCH_SIZE=0
AIRFLOW__WEBSERVER__WORKER_REFRESH_INTERVAL=0
AIRFLOW__WEBSERVER__RELOAD_ON_PLUGIN_CHANGE=false
AIRFLOW__WEBSERVER__SHOW_TRIGGER_FORM_IF_NO_PARAMS=true
AIRFLOW__WEBSERVER__SECRET_KEY= a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6

# Reduce Gunicorn memory usage
AIRFLOW__WEBSERVER__WORKER_CONNECTIONS=50
AIRFLOW__WEBSERVER__ENABLE_PROXY_FIX=false

# ================================
# PERFORMANCE OPTIMIZATION (REDUCED)
# ================================

# Task Execution Limits - REDUCED FOR LOW MEMORY
AIRFLOW__CORE__PARALLELISM=2
AIRFLOW__CORE__MAX_ACTIVE_TASKS_PER_DAG=2
AIRFLOW__CORE__MAX_ACTIVE_RUNS_PER_DAG=1

# Scheduler Optimization - REDUCED
AIRFLOW__SCHEDULER__MAX_TIS_PER_QUERY=2
AIRFLOW__CORE__DAGS_FOLDER_COLLECTION_INTERVAL=60

# ================================
# API & LOGGING
# ================================

# API Configuration
AIRFLOW__API__AUTH_BACKENDS=airflow.api.auth.backend.basic_auth

# Logging Configuration
AIRFLOW__LOGGING__LOGGING_LEVEL=INFO
AIRFLOW__LOGGING__BASE_LOG_FOLDER=/opt/airflow/logs
AIRFLOW__LOGGING__DAG_PROCESSOR_MANAGER_LOG_LOCATION=/opt/airflow/logs/dag_processor_manager/dag_processor_manager.log
AIRFLOW__LOGGING__PROCESSOR_LOG_TARGET=file